<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.15">
<title>Apache Kafka Fundamentals: Exercise Book</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Apache Kafka Fundamentals: Exercise Book</h1>
<div class="details">
<span id="revnumber">version 7.1.1-v1.0.0</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_preamble">Preamble</a></li>
<li><a href="#_lab_01_exploring_apache_kafka">Lab 01 Exploring Apache Kafka</a></li>
<li><a href="#_lab_02_fundamentals_of_apache_kafka">Lab 02 Fundamentals of Apache Kafka</a></li>
<li><a href="#_lab_03_how_kafka_works">Lab 03 How Kafka Works</a></li>
<li><a href="#_lab_04_integrating_kafka_into_your_environment">Lab 04 Integrating Kafka into your Environment</a></li>
<li><a href="#_lab_05_the_confluent_platform">Lab 05 The Confluent Platform</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_preamble">Preamble</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_copyright_trademarks">Copyright &amp; Trademarks</h3>
<div class="paragraph">
<p> <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br></p>
</div>
<div class="paragraph text-center">
<p>Copyright © Confluent, Inc. 2014-2022. <a href="https://www.confluent.io/confluent-privacy-statement/">Privacy Policy</a> | <a href="https://www.confluent.io/terms-of-use/">Terms &amp; Conditions</a>.<br>
Apache, Apache Kafka, Kafka and the Kafka logo are trademarks of the<br>
<a href="http://www.apache.org/">Apache Software Foundation</a></p>
</div>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="_accessing_your_lab_environment">Accessing your Lab Environment</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Welcome to your lab environment! You are connected as user <strong>training</strong>, password <strong>training</strong>.</p>
</li>
<li>
<p>Open a new terminal window</p>
</li>
<li>
<p>Clone the <strong>GitHub</strong> repository with the sample solutions into the folder <code>~/confluent-fundamentals</code>:</p>
<div class="paragraph">
<p>Bash:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git clone --branch 7.1.1-v1.0.0 \
    https://github.com/confluentinc/training-fundamentals-src.git \
    ~/confluent-fundamentals</strong></pre>
</div>
</div>
</li>
<li>
<p>Navigate to the <code>~/confluent-fundamentals</code> folder:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-fundamentals</strong></pre>
</div>
</div>
</li>
<li>
<p>Run a script to add entries to your <code>/etc/hosts</code> file. This allows you to refer to containers in your cluster via hostnames like <code>kafka</code> and <code>zookeeper</code>. If you are prompted for a password for the <code>training</code> account type <code>training</code> as the password:</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This step isn&#8217;t needed if you are following the <strong>Running Labs in Docker for Desktop</strong> appendix.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>~/confluent-fundamentals/update-hosts.sh</strong>
Done!</pre>
</div>
</div>
<div class="paragraph">
<p>This applies to all subsequent command in this exercise book.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_docker_basics">Docker Basics</h4>
<div class="paragraph">
<p>This exercise book heavily relies on Docker (containers). Yet, to successfully complete all the exercises you do <strong>NOT</strong> need any previous knowledge of Docker. Though, if you have some basic knowledge of Docker it is definitely a plus.<br>
If you do not have any prior knowledge of Docker and you have some free time then please try to familiarize yourself with the most fundamental concepts of Docker containers going through some of the interactive labs here: <a href="https://training.play-with-docker.com" target="_blank" rel="noopener">https://training.play-with-docker.com</a></p>
</div>
<div class="paragraph">
<p> 
 
 </p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stophand.png" alt="stophand" width="200]">
</div>
</div>
<div class="paragraph text-center">
<p><strong>STOP HERE. THIS IS THE END OF THE EXERCISE.</strong></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_01_exploring_apache_kafka">Lab 01 Exploring Apache Kafka</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_exploring_apache_kafka">Exploring Apache Kafka</h3>
<div class="paragraph">
<p>In this exercise we are going to explore a very simple Kafka cluster consisting of a single broker and a single ZooKeeper instance. We will also run a simple Kafka client - a producer - that writes some IoT data from a public source into Kafka. We will then use a Kafka tool called <code>kafka-console-consumer</code> to read that data from Kafka.</p>
</div>
<div class="paragraph">
<p>Don&#8217;t worry if the terms <strong>broker</strong>, <strong>ZooKeeper</strong> and <strong>Kafka client</strong> don&#8217;t make much sense to you, we will introduce them in detail in the next module.</p>
</div>
<div class="paragraph">
<p>Here is a sketch of how that looks:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/exploring/exploring-kafka.png" alt="exploring kafka">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For more info about our source of IoT data please refer to the following URL: <a href="https://digitransit.fi/en/developers/apis/4-realtime-api/vehicle-positions/" class="bare">https://digitransit.fi/en/developers/apis/4-realtime-api/vehicle-positions/</a>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_running_a_simple_kafka_cluster">Running a simple Kafka Cluster</h4>
<div class="paragraph">
<p>We are going to run all components of our simple Kafka cluster in Docker containers.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To do this navigate to the project folder and execute the <code>start.sh</code> script:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-fundamentals/labs/exploring</strong>
$ <strong>./start.sh</strong></pre>
</div>
</div>
<div class="paragraph">
<p>Starting the cluster will take a moment, thus be patient. You will observe an output similar to this (shortened for readability):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
Creating network "explore_confluent" with the default driver
Creating explore_producer_1  ... done
Creating explore_kafka_1     ... done
Creating explore_zookeeper_1 ... done
Waiting kafka to launch on 9092...
kafka not yet ready...
kafka not yet ready...
...
kafka is now ready!
Connection to kafka port 9092 [tcp/XmlIpcRegSvc] succeeded!
c5eaba41ac19d739d53e6e44b2909a36563ad22d428d5eac9cc5aaa2dbbea18b</pre>
</div>
</div>
</li>
<li>
<p>Next use the tool <code>kafka-console-consumer</code> installed on your lab VM to read data that the producer is writing to Kafka. Use this command to do so:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-consumer \
    --bootstrap-server kafka:9092 \
    --topic vehicle-positions</strong></pre>
</div>
</div>
<div class="paragraph">
<p>After a short moment you should see records being output on your terminal window in fast cadence. These records are live data coming from an MQTT source. Each record corresponds to a vehicle position (bus, tram or train) of the Finnish public transport provider. The data looks like this (shortened):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
{"VP":{"desi":"65","dir":"1","oper":18,"veh":268,"tst":"2019-10-18T08:38:31.978Z","tsi":1571387911,"spd":6.33,"hdg":353,"lat":60.233573,"long":24.978816,"acc":0.34,"dl":180,"odo":null,"drst":null,"oday":"2019-10-18","jrn":127,"line":850,"start":"11:12","loc":"GPS","stop":null,"route":"1065","occu":0}}
{"VP":{"desi":"643","dir":"1","oper":18,"veh":2983,"tst":"2019-10-18T08:38:31.970Z","tsi":1571387911,"spd":12.98,"hdg":20,"lat":60.374053,"long":25.018964,"acc":-0.84,"dl":-278,"odo":22802,"drst":null,"oday":"2019-10-18","jrn":10,"line":1041,"start":"10:58","loc":"GPS","stop":null,"route":"9643","occu":0}}
{"VP":{"desi":"633","dir":"2","oper":12,"veh":1812,"tst":"2019-10-18T08:38:32.017Z","tsi":1571387912,"spd":0.00,"hdg":268,"lat":60.323116,"long":25.013476,"acc":0.00,"dl":-120,"odo":6584,"drst":0,"oday":"2019-10-18","jrn":44,"line":1074,"start":"11:25","loc":"GPS","stop":null,"route":"4633","occu":0}}
{"VP":{"desi":"40","dir":"2","oper":12,"veh":825,"tst":"2019-10-18T08:38:32.017Z","tsi":1571387912,"spd":0.09,"hdg":183,"lat":60.206946,"long":24.898891,"acc":-0.00,"dl":-120,"odo":3927,"drst":1,"oday":"2019-10-18","jrn":1467,"line":62,"start":"11:21","loc":"GPS","stop":1160109,"route":"1040","occu":0}}
...</pre>
</div>
</div>
</li>
<li>
<p>Stop the consumer by pressing <code>CTRL-c</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<strong>MQTT</strong> stands for <strong>Message Queuing Telemetry Transport</strong>. It is a lightweight publish and subscribe system where you can publish and receive messages as a client. MQTT is a simple messaging protocol, designed for constrained devices with low-bandwidth. So, it&#8217;s the perfect solution for <strong>Internet of Things</strong> (IoT) applications.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_cleanup">Cleanup</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Before you end, please clean up your system by running the <code>stop.sh</code> script in the project folder:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>./stop.sh</strong></pre>
</div>
</div>
<div class="paragraph">
<p>You should see this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>producer
Stopping explore_zookeeper_1 ... done
Stopping explore_kafka_1     ... done
Removing explore_producer_1  ... done
Removing explore_zookeeper_1 ... done
Removing explore_kafka_1     ... done
Removing network explore_confluent</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_conclusion">Conclusion</h4>
<div class="paragraph">
<p>In this exercise we created a simple real-time data pipeline powered by Kafka. We have written data that originates from a public IoT data source into a simple Kafka cluster. This data we then have consumed with a simple Kafka tool called <code>kafka-console-consumer</code>.</p>
</div>
<div class="paragraph">
<p> <br>
 <br></p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stophand.png" alt="stophand" width="200">
</div>
</div>
<div class="paragraph text-center">
<p><strong>STOP HERE. THIS IS THE END OF THE EXERCISE.</strong></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_02_fundamentals_of_apache_kafka">Lab 02 Fundamentals of Apache Kafka</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_fundamentals_of_apache_kafka">Fundamentals of Apache Kafka</h3>
<div class="paragraph">
<p>In this exercise we are going to use a basic Kafka cluster consisting of a single broker and ZooKeeper instance. Once again we are going to run all components of our Kafka cluster in Docker containers.</p>
</div>
<div class="paragraph">
<p>Here is a sketch of the lab setup:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/fundamentals/fundamentals.png" alt="fundamentals">
</div>
</div>
<div class="sect3">
<h4 id="_prerequisites">Prerequisites</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the Kafka cluster by navigating to the project folder and executing the <code>start.sh</code> script:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-fundamentals/labs/fundamentals</strong>
$ <strong>./start.sh</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_working_with_topics">Working with Topics</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Let&#8217;s first use the <code>kafka-topics</code> tool to list all topics registered on the Kafka cluster:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics --bootstrap-server kafka:9092 --list</strong></pre>
</div>
</div>
<div class="paragraph">
<p>you should see this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>_confluent-metrics</pre>
</div>
</div>
<div class="paragraph">
<p>Apparently there is only a single topic called <code>_confluent-metrics</code> registered in the cluster.</p>
</div>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Now let&#8217;s create a topic called <code>vehicle-positions</code> with 6 partitions and a <code>replication-factor</code> of <code>1</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics --bootstrap-server kafka:9092 \
    --create \
    --topic vehicle-positions \
    --partitions 6 \
    --replication-factor 1</strong></pre>
</div>
</div>
</li>
<li>
<p>To verify the details of the topic just created we can use the <code>--describe</code> parameter:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics --bootstrap-server kafka:9092 \
    --describe \
    --topic vehicle-positions</strong></pre>
</div>
</div>
<div class="paragraph">
<p>giving us this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Topic: vehicle-positions	TopicId: f5HGgfhBTliEK7zLkBgZxg	PartitionCount: 6	ReplicationFactor: 1	Configs: segment.bytes=536870912,retention.bytes=536870912
	Topic: vehicle-positions	Partition: 0	Leader: 101	Replicas: 101	Isr: 101	Offline:
	Topic: vehicle-positions	Partition: 1	Leader: 101	Replicas: 101	Isr: 101	Offline:
	Topic: vehicle-positions	Partition: 2	Leader: 101	Replicas: 101	Isr: 101	Offline:
	Topic: vehicle-positions	Partition: 3	Leader: 101	Replicas: 101	Isr: 101	Offline:
	Topic: vehicle-positions	Partition: 4	Leader: 101	Replicas: 101	Isr: 101	Offline:
	Topic: vehicle-positions	Partition: 5	Leader: 101	Replicas: 101	Isr: 101	Offline:</pre>
</div>
</div>
<div class="paragraph">
<p>We can see a line for each partition created. For each partition we get the leader broker, the replica placement and the ISR list (In-sync Replica list). In our case the list looks simple since we only have one single replica, placed on broker <code>101</code>.</p>
</div>
</li>
<li>
<p>Try to create another topic called <code>test-topic</code> with 3 partitions and replication factor 1.</p>
</li>
<li>
<p>List all the topics in your Kafka cluster. You should see this:</p>
<div class="listingblock">
<div class="content">
<pre>_confluent-metrics
test-topic
vehicle-positions</pre>
</div>
</div>
</li>
<li>
<p>To delete the topic <code>test-topic</code> use the following command:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics --bootstrap-server kafka:9092 \
    --delete \
    --topic test-topic</strong></pre>
</div>
</div>
</li>
<li>
<p>Double check that the topic is gone by listing all topics in the cluster.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_producing_and_consuming_data">Producing and consuming data</h4>
<div class="paragraph">
<p>Let&#8217;s add some data to a topic <code>sample-topic</code> by running the command line tool <code>kafka-console-producer</code>. Then we will use the tool <code>kafka-console-consumer</code> to consume the same data.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the tool <code>kafka-topics</code> to create a topic called <code>sample-topic</code> with 3 partitions and a replication factor of 1.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you forgot how to do this, then have a look at how we created the topic <code>vehicle-positions</code> earlier in this exercise.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Run the <code>kafka-console-producer</code> command line tool:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-producer --broker-list kafka:9092 \
    --topic sample-topic</strong></pre>
</div>
</div>
</li>
<li>
<p>Type <code>hello</code> at the prompt and hit <code>&lt;Enter&gt;</code>:</p>
<div class="listingblock">
<div class="content">
<pre>&gt;hello</pre>
</div>
</div>
</li>
<li>
<p>Type a few more lines at the prompt (each terminated with <code>&lt;Enter&gt;</code>):</p>
<div class="listingblock">
<div class="content">
<pre>&gt;world
&gt;Kafka
&gt;is
&gt;cool!</pre>
</div>
</div>
<div class="paragraph">
<p>and press <code>CTRL-d</code> when done to exit the producer.</p>
</div>
</li>
<li>
<p>Now use the <code>kafka-console-consumer</code> to consume all data <strong>from the beginning</strong> of topic <code>sample-topic</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-consumer --bootstrap-server kafka:9092 \
    --topic sample-topic \
    --from-beginning</strong></pre>
</div>
</div>
<div class="paragraph">
<p>In my case the output looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>hello
Kafka
is
world
cool!</pre>
</div>
</div>
<div class="paragraph">
<p>Notice how the order of the items entered is scrambled. Please take a moment to reflect why this happens. Discuss your findings with your peers.</p>
</div>
</li>
<li>
<p>End the consumer by pressing <code>CTRL-c</code>.</p>
</li>
<li>
<p>So far we have produced and consumed data without a key. Let&#8217;s now run the producer in a way that we can also enter a key with each value:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-producer --broker-list kafka:9092 \
    --topic sample-topic \
    --property parse.key=true \
    --property key.separator=,</strong></pre>
</div>
</div>
<div class="paragraph">
<p>The last two parameters tell the producer to expect a key and to use the comma (,) as a separator between key and value at the input.</p>
</div>
</li>
<li>
<p>Enter some values at the prompt:</p>
<div class="listingblock">
<div class="content">
<pre>&gt;1,apples
&gt;2,pears
&gt;3,walnuts
&gt;4,peanuts
&gt;5,oranges</pre>
</div>
</div>
<div class="paragraph">
<p>and press <code>CTRL-d</code> to exit the producer.</p>
</div>
</li>
<li>
<p>Let&#8217;s use the console consumer tool and configure it such as that it outputs keys and values:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-consumer --bootstrap-server kafka:9092 \
    --topic sample-topic \
    --from-beginning \
    --property print.key=true</strong></pre>
</div>
</div>
<div class="paragraph">
<p>the output in my case looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>null	hello
null	Kafka
1	    apples
5	    oranges
null	is
4	    peanuts
null	world
null	cool!
2	    pears
3	    walnuts</pre>
</div>
</div>
<div class="paragraph">
<p>Notice how <code>null</code> is output for the key for the values we first entered without defining a key.</p>
</div>
</li>
<li>
<p>Once again the question is: "Why is the order of the items read from the topic not the order that you produced the messages?"</p>
</li>
<li>
<p>Press <code>CTRL-c</code> to exit the consumer.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_zookeeper_shell">Using the ZooKeeper Shell</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Kafka&#8217;s data in ZooKeeper can be accessed using the <code>zookeeper-shell</code> command:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>zookeeper-shell zookeeper</strong></pre>
</div>
</div>
<div class="paragraph">
<p>which will output the following in your terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Connecting to zookeeper
Welcome to ZooKeeper!
JLine support is disabled

WATCHER::

WatchedEvent state:SyncConnected type:None path:null</pre>
</div>
</div>
</li>
<li>
<p>From within the <code>zookeeper-shell</code> application, type <code>ls /</code> to view the directory structure in ZooKeeper. Note the <code>/</code> is required.</p>
<div class="listingblock">
<div class="content">
<pre><strong>ls /</strong></pre>
</div>
</div>
<div class="paragraph">
<p>In our case you should get something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[admin, brokers, cluster, config, consumers, controller, controller_epoch, feature, isr_change_notification, latest_producer_id_block, leadership_priority, log_dir_event_notification, zookeeper]</pre>
</div>
</div>
</li>
<li>
<p>Let&#8217;s see what the <code>brokers</code> node reveals:</p>
<div class="listingblock">
<div class="content">
<pre><strong>ls /brokers</strong>

[ids, seqid, topics]</pre>
</div>
</div>
</li>
<li>
<p>And what do we find under the node <code>ids</code>?</p>
<div class="listingblock">
<div class="content">
<pre><strong>ls /brokers/ids</strong>

[101]</pre>
</div>
</div>
<div class="paragraph">
<p>Note the output <code>[101]</code>, indicating that we have a single broker with ID <code>101</code> in our cluster.</p>
</div>
</li>
<li>
<p>Try to find out what&#8217;s to be found in other nodes of the ZooKeeper data tree, e.g. to find out something about the cluster itself use:</p>
<div class="listingblock">
<div class="content">
<pre><strong>get /cluster/id</strong>

{"version":"1","id":"Rslk7ZJnRsGFfeHwfwhzmw"}</pre>
</div>
</div>
<div class="paragraph">
<p>Here I can see that my cluster ID is equal to <code>Rslk7ZJnRsGFfeHwfwhzmw</code>.</p>
</div>
</li>
<li>
<p>Press <code>CTRL-d</code> to exit the ZooKeeper shell.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_cleanup_2">Cleanup</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Before you end, please clean up your system by running the <code>stop.sh</code> script in the project folder:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>./stop.sh</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_conclusion_2">Conclusion</h4>
<div class="paragraph">
<p>In this exercise we created a simple Kafka cluster. We then used the tool <code>kafka-topics</code> to list, create, describe and delete topics. Next we used the tools <code>kafka-console-producer</code> and <code>kafka-console-consumer</code> to produce data to and consume data from Kafka. Finally we used the ZooKeeper shell to analyze some of the data stored by Kafka in ZooKeeper.</p>
</div>
<div class="paragraph">
<p> <br></p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stophand.png" alt="stophand" width="200">
</div>
</div>
<div class="paragraph text-center">
<p><strong>STOP HERE. THIS IS THE END OF THE EXERCISE.</strong></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_03_how_kafka_works">Lab 03 How Kafka Works</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_how_kafka_works">How Kafka Works</h3>
<div class="paragraph">
<p>In this lab we are going to create a simple Java consumer. The consumer will read data from the topic <code>vehicle-positions</code> that the producer we introduced in an earlier lab produces from our trusted IoT source. In a second step we will scale the consumer (or consumer group) and analyze the effect.</p>
</div>
<div class="paragraph">
<p>Here is a simple graphic of the lab setup:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/advanced-topics/advanced.png" alt="advanced">
</div>
</div>
<div class="sect3">
<h4 id="_prerequisites_2">Prerequisites</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the Kafka cluster by navigating to the project folder and executing the <code>start.sh</code> script:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-fundamentals/labs/advanced-topics</strong>
$ <strong>./start.sh</strong></pre>
</div>
</div>
<div class="paragraph">
<p>This will start our mini Kafka cluster, create the topic <code>vehicle-positions</code>, and then start the producer that is writing data from our IoT source to the topic.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_investigating_the_consumer">Investigating the Consumer</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the <code>consumer</code> subfolder of the project folder:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-fundamentals/labs/advanced-topics/consumer</strong></pre>
</div>
</div>
</li>
<li>
<p>Start Visual Studio Code from within this folder:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>code .</strong></pre>
</div>
</div>
</li>
<li>
<p>Locate the file <code>VehiclePositionConsumer.java</code> at <code>src/main/java/clients</code> and open it. Try to analyze what the code does.</p>
</li>
<li>
<p>To set a breakpoint at line 15, click the left margin and then click on the <code>Debug</code> link right above line 14 to start debugging (or use the menu <strong>Run&#8594;Start Debugging</strong>):</p>
<div class="paragraph">
<p><span class="image"><img src="./images/advanced-topics/consumer-code.png" alt="consumer code"></span></p>
</div>
<div class="paragraph">
<p>The application should start and code execution should stop at line 15:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/advanced-topics/consumer-breakpoint.png" alt="consumer breakpoint"></span></p>
</div>
</li>
<li>
<p>Use the various buttons on the debugging toolbar to navigate through the code either step by step or continue clicking the continue button:</p>
<div class="paragraph">
<p><span class="image"><img src="./images/advanced-topics/debugging-toolbar.png" alt="debugging toolbar"></span></p>
</div>
</li>
<li>
<p>If you let the app run your output in the <code>DEBUG CONSOLE</code> should look similar to this:</p>
<div class="listingblock">
<div class="content">
<pre><strong>* Starting VP Consumer </strong>*
...
offset = 4728, key = /hfp/v1/journey/ongoing/bus/0012/01806/2551/1/Westendinas./14:11/2213206/4/60;24/18/82/13, value = {"VP":{"long":24.823896,"oday":"2019-06-21","lat":60.181576,"odo":14370,"oper":12,"desi":"551","veh":1806,"tst":"2019-06-21T11:46:03Z","dir":"1","tsi":1561117563,"hdg":207,"start":"14:11","dl":34,"jrn":86,"line":842,"spd":0.48,"drst":0,"acc":0.39}}
offset = 4729, key = /hfp/v1/journey/ongoing/bus/0022/00625/4624/2/Tikkurila/14:37/4700210/4/60;25/30/26/22, value = {"VP":{"long":25.062562,"oday":"2019-06-21","lat":60.322748,"odo":3694,"oper":22,"desi":"624","veh":625,"tst":"2019-06-21T11:46:03Z","dir":"2","tsi":1561117563,"hdg":236,"start":"14:37","dl":-60,"jrn":152,"line":809,"spd":3.62,"drst":0,"acc":0.23}}
...</pre>
</div>
</div>
</li>
<li>
<p>Stop the application with the <strong>Stop</strong> button on the debug toolbar.</p>
</li>
<li>
<p>Exit VS Code when done.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_building_the_consumer_docker_image">Building the Consumer Docker image</h4>
<div class="paragraph">
<p>To prepare ourselves to scale the consumer up and down we want to run each consumer instance as a Docker container. We have a Dockerfile for this in our project folder.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the <code>consumer</code> subfolder of the project folder:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-fundamentals/labs/advanced-topics/consumer</strong></pre>
</div>
</div>
</li>
<li>
<p>To build the Docker image run the script <code>build-consumer.sh</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>./build-image.sh</strong></pre>
</div>
</div>
<div class="paragraph">
<p>please be patient, this takes a moment or two. You should see something like this in your terminal (shortened for readability):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Sending build context to Docker daemon  33.28kB
Step 1/13 : FROM gradle:5.2.1-jdk11-slim AS builder
 ---&gt; 22bd673b8ca6
Step 2/13 : WORKDIR /home/gradle/project
 ---&gt; Using cache
 ---&gt; f329118c9919
Step 3/13 : COPY build.gradle ./
 ---&gt; Using cache
 ---&gt; a8f70d1286d9
...
Step 12/13 : WORKDIR /app/project
 ---&gt; Running in dc8f7895f854
Removing intermediate container dc8f7895f854
 ---&gt; d6a3e36f38d3
Step 13/13 : CMD java -classpath "lib/*" clients.VehiclePositionConsumer
 ---&gt; Running in c842fd617a64
Removing intermediate container c842fd617a64
 ---&gt; 04963927cc8b
Successfully built 04963927cc8b
Successfully tagged sample-consumer:1.0</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_running_and_scaling_our_consumer">Running and scaling our consumer</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run your first consumer (an instance of the Docker image you just built) as follows:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>./run-consumer.sh</strong></pre>
</div>
</div>
<div class="paragraph">
<p>you should see a long ID, something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>97d34f47f2e477f66f360cd6b0e83bb...</pre>
</div>
</div>
<div class="paragraph">
<p>indicating that a container with the above ID is running your consumer (in the background, as a daemon).</p>
</div>
</li>
<li>
<p>Let&#8217;s use the <code>kafka-consumer-groups</code> tool to see what&#8217;s going on:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-consumer-groups \
  --bootstrap-server kafka:9092 \
  --group vp-consumer \
  --describe</strong></pre>
</div>
</div>
<div class="paragraph">
<p>we get this kind of output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>GROUP           TOPIC             PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                                 HOST            CLIENT-ID
vp-consumer     vehicle-positions 2          0               6607            6607            consumer-vp-consumer-1-0b9d07d9-322b-46c7-a11c-b822aabab902 /172.21.0.5     consumer-vp-consumer-1
vp-consumer     vehicle-positions 3          147             7151            7004            consumer-vp-consumer-1-0b9d07d9-322b-46c7-a11c-b822aabab902 /172.21.0.5     consumer-vp-consumer-1
vp-consumer     vehicle-positions 1          0               7689            7689            consumer-vp-consumer-1-0b9d07d9-322b-46c7-a11c-b822aabab902 /172.21.0.5     consumer-vp-consumer-1
vp-consumer     vehicle-positions 4          2353            6183            3830            consumer-vp-consumer-1-0b9d07d9-322b-46c7-a11c-b822aabab902 /172.21.0.5     consumer-vp-consumer-1
vp-consumer     vehicle-positions 5          1500            7443            5943            consumer-vp-consumer-1-0b9d07d9-322b-46c7-a11c-b822aabab902 /172.21.0.5     consumer-vp-consumer-1
vp-consumer     vehicle-positions 0          0               6881            6881            consumer-vp-consumer-1-0b9d07d9-322b-46c7-a11c-b822aabab902 /172.21.0.5     consumer-vp-consumer-1</pre>
</div>
</div>
<div class="paragraph">
<p>We can see that we have a single client (<code>consumer-vp-consumer-1-0b9&#8230;&#8203;</code>) consuming from all 6 partitions. We can also see the current lag on each partition. The latter being the so called <strong>consumer lag</strong>, which is an indication whether or not the consumer group is falling behind.</p>
</div>
</li>
<li>
<p>Repeat the above command a few times and observe how the <strong>LAG</strong> behaves.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You may want to use the <code>watch</code> command to observe how the <strong>LAG</strong> is varying over time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>watch kafka-consumer-groups \
    --bootstrap-server kafka:9092 \
    --group vp-consumer \
    --describe</strong></pre>
</div>
</div>
<div class="paragraph">
<p>End watching by pressing <code>CTRL-c</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Let&#8217;s run another consumer and scale up to 2 instances:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>./run-consumer.sh</strong></pre>
</div>
</div>
</li>
<li>
<p>And describe the consumer group <code>vp-consumer</code> again:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-consumer-groups --bootstrap-server kafka:9092 \
  --group vp-consumer \
  --describe</strong>

GROUP           TOPIC             PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                   HOST            CLIENT-ID
vp-consumer     vehicle-positions 0          14878           14972           94              consumer-vp-consumer-1-0b9... /172.21.0.5     consumer-vp-consumer-1
vp-consumer     vehicle-positions 1          16895           16971           76              consumer-vp-consumer-1-0b9... /172.21.0.5     consumer-vp-consumer-1
vp-consumer     vehicle-positions 2          15186           15278           92              consumer-vp-consumer-1-0b9... /172.21.0.5     consumer-vp-consumer-1
vp-consumer     vehicle-positions 3          16271           16330           59              consumer-vp-consumer-1-84f... /172.21.0.6     consumer-vp-consumer-1
vp-consumer     vehicle-positions 4          14009           14066           57              consumer-vp-consumer-1-84f... /172.21.0.6     consumer-vp-consumer-1
vp-consumer     vehicle-positions 5          17284           17339           55              consumer-vp-consumer-1-84f... /172.21.0.6     consumer-vp-consumer-1</pre>
</div>
</div>
<div class="paragraph">
<p>Now we see, that there are 2 consumer instances <code>consumer-vp-consumer-1-0b9&#8230;&#8203;</code> and <code>consumer-vp-consumer-1-84f&#8230;&#8203;</code> sharing their work. A fully transparent rebalance of the workload has happened!<br>
Please also note that the <strong>LAG</strong> does not grow so fast as before since we have parallelized the workload.</p>
</div>
</li>
<li>
<p>Scale up the consumer group further and observe how the consumer lag behaves.</p>
</li>
<li>
<p>What happens if you scale the consumer group to more than 6 instances?</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_cleanup_3">Cleanup</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Before you end, please clean up your system by running the <code>stop.sh</code> script in the project folder:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-fundamentals/labs/advanced-topics</strong>
$ <strong>./stop.sh</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_conclusion_3">Conclusion</h4>
<div class="paragraph">
<p>In this lab we have built and run a simple Kafka consumer. We then have scaled the consumer up and analyzed the effect of the scaling using the tool <code>kafka-consumer-groups</code>.</p>
</div>
<div class="paragraph">
<p> <br>
 <br></p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stophand.png" alt="stophand" width="200]">
</div>
</div>
<div class="paragraph text-center">
<p><strong>STOP HERE. THIS IS THE END OF THE EXERCISE.</strong></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_04_integrating_kafka_into_your_environment">Lab 04 Integrating Kafka into your Environment</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_integrating_kafka_into_your_environment">Integrating Kafka into your Environment</h3>
<div class="paragraph">
<p>In this lab we are going to use the Confluent Schema Registry to manage the schemas of the messages we&#8217;ll be generating, where their values will be formatted in Avro. You will also be using an MQTT source connector in Kafka Connect to import data from an IoT data source.</p>
</div>
<div class="paragraph">
<p>Here is a simple graphic of the lab setup:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ecosystem/kafka-ecosystem.png" alt="kafka ecosystem">
</div>
</div>
<div class="sect3">
<h4 id="_prerequisites_3">Prerequisites</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run a simple Kafka cluster, including Confluent Schema Registry, by navigating to the project folder and executing the <code>start.sh</code> script:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-fundamentals/labs/ecosystem</strong>
$ <strong>./start.sh</strong></pre>
</div>
</div>
</li>
<li>
<p>Let&#8217;s create the topic called <code>stations-avro</code> we need for our sample:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-topics \
    --bootstrap-server kafka:9092 \
    --create \
    --topic stations-avro \
    --partitions 1 \
    --replication-factor 1</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_generating_and_consuming_avro_messages">Generating and Consuming Avro Messages</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Define an Avro schema for our records and assign it to a variable <code>SCHEMA</code>. The command to do so looks like this:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>export SCHEMA='{
    "type":"record",
    "name":"station",
    "fields":[
        {"name":"city","type":"string"},
        {"name":"country","type":"string"}
    ]
}'</strong></pre>
</div>
</div>
</li>
<li>
<p>Now let&#8217;s use this schema and provide it as an argument to the <code>kafka-avro-console-producer</code> tool:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-avro-console-producer \
  --broker-list kafka:9092 \
  --topic stations-avro \
  --property schema.registry.url=http://schema-registry:8081 \
  --property value.schema="$SCHEMA"</strong></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We pass the information about the location of the Schema Registry and the schema itself as properties to the tool.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Now let&#8217;s add some data. Enter the following values to the producer:</p>
<div class="listingblock">
<div class="content">
<pre><strong>{"city": "Pretoria", "country": "South Africa"}
{"city": "Cairo", "country": "Egypt"}
{"city": "Nairobi", "country": "Kenya"}
{"city": "Addis Ababa", "country": "Ethiopia"}</strong></pre>
</div>
</div>
</li>
<li>
<p>Exit the <code>kafka-avro-console-producer</code> by pressing <code>CTRL-c</code>.</p>
</li>
<li>
<p>Run the <code>kafka-avro-console-consumer</code> to read the Avro formatted messages:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-avro-console-consumer \
  --bootstrap-server kafka:9092 \
  --topic stations-avro \
  --from-beginning \
  --property schema.registry.url=http://schema-registry:8081</strong></pre>
</div>
</div>
<div class="paragraph">
<p>And you should see this output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"city":"Pretoria","country":"South Africa"}
{"city":"Cairo","country":"Egypt"}
{"city":"Nairobi","country":"Kenya"}
{"city":"Addis Ababa","country":"Ethiopia"}</pre>
</div>
</div>
</li>
<li>
<p>Stop the Avro consumer by pressing <code>CTRL-c</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_using_kafka_connect_to_import_mqtt_data">Using Kafka Connect to Import MQTT Data</h4>
<div class="paragraph">
<p>In this exercise we will use the MQTT source connector from Confluent Hub (<a href="https://confluent.io/hub" target="_blank" rel="noopener">https://confluent.io/hub</a>) to import data from our trusted MQTT source.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a topic <code>vehicle-positions</code> with 6 partitions and replication factor 1.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you forgot how to do this, then have a look at how we created the topic <code>vehicle-positions</code> in the exercise <strong>Fundamentals of Apache Kafka</strong>. Alternatively simply type <code>kafka-topics</code> at the command line and hit <code>&lt;Enter&gt;</code>. A description of all options will be output.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Kafka Connect is running as part of our cluster. It already has the MQTT Connector installed from Confluent Hub. Create a Kafka Connect MQTT Source connector using the Connect REST API:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>curl -s -X POST -H 'Content-Type: application/json' -d '{
    "name" : "mqtt-source",
    "config" : {
        "connector.class" : "io.confluent.connect.mqtt.MqttSourceConnector",
        "tasks.max" : "1",
        "mqtt.server.uri" : "tcp://mqtt.hsl.fi:1883",
        "mqtt.topics" : "/hfp/v2/journey/ongoing/vp/train/#",
        "kafka.topic" : "vehicle-positions",
        "confluent.topic.bootstrap.servers": "kafka:9092",
        "confluent.topic.replication.factor": "1",
        "confluent.license":"",
        "key.converter": "org.apache.kafka.connect.storage.StringConverter",
        "value.converter": "org.apache.kafka.connect.converters.ByteArrayConverter"
        }
    }' http://connect:8083/connectors | jq .</strong></pre>
</div>
</div>
<div class="paragraph">
<p>This will import position data of all <strong>trains</strong>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you are curious, you can find the Dockerfile in the subfolder <code>connect</code> of the project folder, which we use to install the requested MQTT connector from Confluent Hub on top of the official Confluent Connector image.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Check if connector is loaded and status is 'RUNNING':</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>curl -s http://connect:8083/connectors</strong>

["mqtt-source"]</pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>curl -s http://connect:8083/connectors/mqtt-source/status | jq .</strong>

{
  "name": "mqtt-source",
  "connector": {
    "state": "RUNNING",
    "worker_id": "connect:8083"
  },
  "tasks": [
    {
      "id": 0,
      "state": "RUNNING",
      "worker_id": "connect:8083"
    }
  ],
  "type": "source"
}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Both, the state of the connector and the task should be <code>RUNNING</code>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Let&#8217;s see if some data is generated:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>kafka-console-consumer --bootstrap-server kafka:9092 \
    --topic vehicle-positions \
    --from-beginning \
    --max-messages 5</strong></pre>
</div>
</div>
<div class="paragraph">
<p>and you should see an output similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"VP":{"desi":"K","dir":"2","oper":90,"veh":1036,"tst":"2019-10-18T09:10:27.021Z","tsi":1571389827,"spd":0.20,"hdg":199,"lat":60.332660,"long":25.068842,"acc":0.07,"dl":-15,"odo":8187,"drst":1,"oday":"2019-10-18","jrn":9304,"line":280,"start":"12:02","loc":"GPS","stop":4730551,"route":"3001K","occu":0}}
{"VP":{"desi":"P","dir":"1","oper":90,"veh":1035,"tst":"2019-10-18T09:10:27.046Z","tsi":1571389827,"spd":0.00,"hdg":24,"lat":60.230289,"long":24.883413,"acc":0.00,"dl":-60,"odo":7567,"drst":0,"oday":"2019-10-18","jrn":8657,"line":636,"start":"11:58","loc":"GPS","stop":1294552,"route":"3002P","occu":0}}
{"VP":{"desi":"U","dir":"1","oper":90,"veh":1075,"tst":"2019-10-18T09:10:27.148Z","tsi":1571389827,"spd":0.00,"hdg":177,"lat":60.173487,"long":24.940247,"acc":0.00,"dl":120,"odo":0,"drst":1,"oday":"2019-10-18","jrn":8463,"line":292,"start":"12:12","loc":"GPS","stop":1020502,"route":"3002U","occu":0}}
{"VP":{"desi":"K","dir":"2","oper":90,"veh":1064,"tst":"2019-10-18T09:10:27.153Z","tsi":1571389827,"spd":0.00,"hdg":9,"lat":60.403977,"long":25.106410,"acc":0.00,"dl":120,"odo":8,"drst":1,"oday":"2019-10-18","jrn":9308,"line":280,"start":"12:12","loc":"GPS","stop":9040502,"route":"3001K","occu":0}}
{"VP":{"desi":"I","dir":"1","oper":90,"veh":1034,"tst":"2019-10-18T09:10:27.163Z","tsi":1571389827,"spd":0.00,"hdg":174,"lat":60.261366,"long":24.854879,"acc":0.00,"dl":0,"odo":37563,"drst":0,"oday":"2019-10-18","jrn":9048,"line":279,"start":"11:26","loc":"GPS","stop":4150501,"route":"3001I","occu":0}}
Processed a total of 5 messages</pre>
</div>
</div>
<div class="paragraph">
<p>demonstrating that indeed, the MQTT source connector did import vehicle positions from the source.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_cleanup_4">Cleanup</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Before you end, please clean up your system by running the <code>stop.sh</code> script in the project folder:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>./stop.sh</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_conclusion_4">Conclusion</h4>
<div class="paragraph">
<p>In this lab we have defined an Avro schema used to serialize and deserialize the value part of our messages that we write to and the read from a topic in Kafka. We used the two command line tools <code>kafka-avro-console-producer</code> and <code>kafka-avro-console-consumer</code> for this task. We also used an MQTT source connector in Kafka Connect to import data from an IoT data source.</p>
</div>
<div class="paragraph">
<p> 
 
 </p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stophand.png" alt="stophand" width="200]">
</div>
</div>
<div class="paragraph text-center">
<p><strong>STOP HERE. THIS IS THE END OF THE EXERCISE.</strong></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_05_the_confluent_platform">Lab 05 The Confluent Platform</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_the_confluent_platform">The Confluent Platform</h3>
<div class="paragraph">
<p>In this exercise we are going to use 3 parts of the Confluent Platform that add tremendous value to a real-time stream processing platform powered by Apache Kafka&#174;. We will use Confluent Control Center to monitor and analyze our Kafka cluster, and to inspect our topic <code>vehicle-positions</code>. We will also leverage the ksqlDB integration of Control Center to get our feet wet with ksqlDB. Finally we will use the ksqlDB CLI to do some simple stream processing.</p>
</div>
<div class="paragraph">
<p>Here is a simple graphic of the lab setup:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/confluent-platform/cp.png" alt="cp">
</div>
</div>
<div class="sect3">
<h4 id="_prerequisites_4">Prerequisites</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the application by navigating to the project folder and executing the <code>start.sh</code> script:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-fundamentals/labs/confluent-platform</strong>
$ <strong>./start.sh</strong></pre>
</div>
</div>
<div class="paragraph">
<p>This will start the Kafka cluster, ksqlDB Server, Confluent Control Center and the producer. It will take approximately 2 minutes for Control Center to start serving.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Under certain circumstances the producer may fail and no (more) data is generated. If this happens to you, then the best solution is to start over. Execute <code>./stop.sh</code> on the command line, and then execute <code>./start.sh</code> again.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_monitoring_and_inspecting_our_kafka_cluster_with_confluent_control_center">Monitoring and Inspecting our Kafka cluster with Confluent Control Center</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a browser window and navigate to <a href="http://localhost:9021" target="_blank" rel="noopener">http://localhost:9021</a>. You should see this:</p>
<div class="paragraph">
<p><span class="image"><img src="./images/confluent-platform/c3-clusters.png" alt="c3 clusters"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If your cluster is shown as <strong>unhealthy</strong> then you may have to wait a few moments until the cluster has stabilized.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Select <strong>controlcenter.cluster</strong> and you&#8217;ll see a view called <strong>Cluster overview</strong> showing a set of cluster metrics that are indicators for the overall health of the Kafka cluster:</p>
<div class="paragraph">
<p><span class="image"><img src="./images/confluent-platform/c3-brokers-overview.png" alt="c3 brokers overview"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Notice the <strong>Control Center Cluster</strong> tabs on the left with the items <code>Brokers</code>, <code>Topics</code>, <code>Connect</code> and so on. We are currently on the <code>Cluster overview</code> tab.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>From the list of tabs on the left select <strong>Topics</strong>. You should see this:</p>
<div class="paragraph">
<p><span class="image"><img src="./images/confluent-platform/c3-topics.png" alt="c3 topics"></span></p>
</div>
<div class="paragraph">
<p>We currently have two topics in our cluster <code>vehicle-positions</code> and <code>default_ksql_processing_log</code> (created automatically by ksqlDB for its internal use).</p>
</div>
</li>
<li>
<p>Click on the topic <code>vehicle-positions</code> and you will be transferred to the topic <strong>Overview</strong> page:</p>
<div class="paragraph">
<p><span class="image"><img src="./images/confluent-platform/c3-topic-overview.png" alt="c3 topic overview"></span></p>
</div>
<div class="paragraph">
<p>Here you see that our topic has 6 partitions and that they all reside on broker <code>101</code> (the only one we have). Notice that this is a tabbed view and we are on the <strong>Overview</strong> tab.</p>
</div>
</li>
<li>
<p>Click on the <strong>Messages</strong> tab to see this:</p>
<div class="paragraph">
<p><span class="image"><img src="./images/confluent-platform/c3-topic-messages.png" alt="c3 topic messages"></span></p>
</div>
<div class="paragraph">
<p>Here we get a peek into the inflowing records. Please familiarize yourself with this view. Notice that you have 2 display modes for the records, tabular and card view. Experiment with them. Also notice the <strong>Topic Summary</strong> on the left side of the view, listing message fields and other information about the topic.</p>
</div>
</li>
<li>
<p>Now click on the tab <strong>Schema</strong>. You will not see anything meaningful here since we are not using <strong>AVRO, Protobuf, or JSON</strong> as data format in our sample. If we used one of these, then this view would show you schema details and version(s).</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_using_ksqldb_for_simple_real_time_stream_transformations">Using ksqlDB for simple real-time stream transformations</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the list of tabs on the left select <strong>ksqlDB</strong>. You should see this:</p>
<div class="imageblock">
<div class="content">
<img src="./images/confluent-platform/c3-ksql-overview.png" alt="c3 ksql overview">
</div>
</div>
<div class="paragraph">
<p>This is the list of connected ksqlDB clusters. Currently we only have one cluster called <strong>ksqldb</strong>.</p>
</div>
</li>
<li>
<p>Select this <strong>ksqldb</strong> cluster. You should see this:</p>
<div class="paragraph">
<p><span class="image"><img src="./images/confluent-platform/c3-ksql.png" alt="c3 ksql"></span></p>
</div>
<div class="paragraph">
<p>Notice that this is a tabbed view. Currently we are on the <strong>ksqlDB Editor</strong> tab.</p>
</div>
</li>
<li>
<p>In the ksqlDB editor field of this view enter <code>SHOW topics;</code> and then click the button <strong>Run</strong>. In the result area you should see a list of all topics that are defined in Kafka. The last topic in the list should be our <code>vehicle-positions</code> topic.</p>
</li>
<li>
<p>Now enter <code>PRINT 'vehicle-positions';</code> in the ksqlDB editor field and then click the <strong>Run</strong> button. You should get a raw output of the content of the topic <code>vehicle-positions</code></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The single quotes are vital to prevent the hyphen from causing an error.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/confluent-platform/c3-ksql-print-topic.png" alt="c3 ksql print topic">
</div>
</div>
<div class="paragraph">
<p>Click the button <strong>Stop</strong> when done.</p>
</div>
</li>
<li>
<p>Now let&#8217;s define a <strong>stream</strong> from the topic <code>vehicle-positions</code>. In the ksqlDB editor field enter the following query:</p>
<div class="listingblock">
<div class="content">
<pre>CREATE STREAM vehicle_positions(
    VP STRUCT&lt;
        desi  STRING,
        dir  STRING,
        oper  INTEGER,
        veh  INTEGER,
        tst  STRING,
        tsi  BIGINT,
        spd  DOUBLE,
        hdg  INTEGER,
        lat  DOUBLE,
        long  DOUBLE,
        acc  DOUBLE,
        dl  INTEGER,
        odo  INTEGER,
        drst  INTEGER,
        oday  STRING,
        jrn  INTEGER,
        line  INTEGER,
        start  STRING,
        loc  STRING,
        stop  STRING,
        route  STRING,
        occu  INTEGER,
        seq  INTEGER
    &gt;
    ) WITH(KAFKA_TOPIC='vehicle-positions', VALUE_FORMAT='JSON');</pre>
</div>
</div>
<div class="paragraph">
<p>and then click the <strong>Run</strong> button. ksqlDB will create a stream called <code>VEHICLE_POSITIONS</code>. You should see an output generated similar to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"@type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"currentStatus"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"statementText"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CREATE STREAM VEHICLE_POSITIONS (VP STRUCT&lt;DESI STRING, DIR STRING, OPER INTEGER, VEH INTEGER, TST STRING, TSI BIGINT, SPD DOUBLE, HDG INTEGER, LAT DOUBLE, LONG DOUBLE, ACC DOUBLE, DL INTEGER, ODO INTEGER, DRST INTEGER, ODAY STRING, JRN INTEGER, LINE INTEGER, START STRING, LOC STRING, STOP STRING, ROUTE STRING, OCCU INTEGER, SEQ INTEGER&gt;) WITH (KAFKA_TOPIC='vehicle-positions', KEY_FORMAT='KAFKA', VALUE_FORMAT='JSON');"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"commandId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"stream/`VEHICLE_POSITIONS`/create"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"commandStatus"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SUCCESS"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Stream created"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"queryId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"commandSequenceNumber"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
  </span><span class="nl">"warnings"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Now we want to use the query data from the stream we just created. In the ksqlDB editor field enter the following query:</p>
<div class="listingblock">
<div class="content">
<pre>SELECT vp-&gt;desi, vp-&gt;dir FROM VEHICLE_POSITIONS EMIT CHANGES;</pre>
</div>
</div>
<div class="paragraph">
<p>and we will see an output similar to this (This may take a few seconds to populate the table on the lower right corner of the screen):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>717A | 1
N | 1
736 | 1
18 | 2
203N | 2
172 | 1
975 | 2
841 | 2
55 | 1
443 | 1</pre>
</div>
</div>
</li>
<li>
<p>Press <strong>Stop</strong> to stop to end the query.</p>
</li>
<li>
<p>Now let&#8217;s try to filter the data and only show records for the bus number <a href="https://reittiopas.hsl.fi/linjat/HSL:4600" target="_blank" rel="noopener">600: Rautatientori - Lentoasema</a>. In the ksqlDB editor field enter the following query:</p>
<div class="listingblock">
<div class="content">
<pre>SELECT * FROM VEHICLE_POSITIONS
      WHERE vp-&gt;desi='600'
      EMIT CHANGES;</pre>
</div>
</div>
<div class="paragraph">
<p>Now we get only output with a route number of <code>'600'</code>.</p>
</div>
</li>
<li>
<p>Press <strong>Stop</strong> to stop to end the query.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_cleanup_5">Cleanup</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Before you end, please clean up your system by running the <code>stop.sh</code> script in the project folder from your labVM Terminal window:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd ~/confluent-fundamentals/labs/confluent-platform</strong>
$ <strong>./stop.sh</strong></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_conclusion_5">Conclusion</h4>
<div class="paragraph">
<p>In this lab we used Confluent Control Center to monitor our Kafka cluster. We used it to inspect the topic <code>vehicle-positions</code>, specifically the messages that flow into the topic and their schema. We also observed the consumer lag. Finally, we used ksqlDB to do simple real-time stream transformations.</p>
</div>
<div class="paragraph">
<p> <br>
 <br></p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/stophand.png" alt="stophand" width="200]">
</div>
</div>
<div class="paragraph text-center">
<p><strong>STOP HERE. THIS IS THE END OF THE EXERCISE.</strong></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 7.1.1-v1.0.0<br>
Last updated 2022-09-08 23:11:04 UTC
</div>
</div>
</body>
</html>